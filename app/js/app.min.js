document.addEventListener("DOMContentLoaded", () => {
    const widthScreen = window.innerWidth || document.documentElement.clientWidth ||
        document.body.clientWidth;

    if (document.getElementById('scene1')) {
        new Parallax(document.getElementById('scene1'));
    }

    if (widthScreen > 991) {
        var wow2 = new WOW(
            {
                boxClass: 'wow2',      // animated element css class (default is wow)
                animateClass: 'animate__animated', // animation css class (default is animated)
                offset: 200,          // distance to the element when triggering the animation (default is 0)
                mobile: true,       // trigger animations on mobile devices (default is true)
                live: true,       // act on asynchronously loaded content (default is true)
                callback: function (box) {

                },
                scrollContainer: null // optional scroll container selector, otherwise use window
            }
        );
        wow2.init();

        var controller = new ScrollMagic.Controller({
            globalSceneOptions: {
                triggerHook: 'onLeave',
                duration: "200%" // this works just fine with duration 0 as well
            }
        });

        // get all slides
        var slides = document.querySelectorAll("section.panel");

        // create scene for every slide
        for (var i = 0; i < slides.length; i++) {
            new ScrollMagic.Scene({
                triggerElement: slides[i]
            })
                .setPin(slides[i], {pushFollowers: false})
                //.addIndicators() // add indicators (requires plugin)
                .addTo(controller);
        }


        if (document.getElementById('scene2')) {
            new Parallax(document.getElementById('scene2'));
        }
        if (document.getElementById('scene3')) {
            new Parallax(document.getElementById('scene3'));
        }
        if (document.getElementById('scene4')) {
            new Parallax(document.getElementById('scene4'));
        }


    }

    var controller2 = new ScrollMagic.Controller(
        {
            globalSceneOptions: {
                once: true
            }
        });
    if (document.getElementById('animate')) {
        let sceneAnimate = new ScrollMagic.Scene({triggerElement: "#animate"})
            .setClassToggle("#animate", "active") // add class toggle
            .reverse(false)
            .on("start", () => {

                //document.getElementById('animate').classList.add('active');
                let lamps = document.querySelectorAll(".compact-line__item__active");
                lamps.forEach(function (item, idx) {
                    setTimeout(() => {
                        item.classList.add('active');
                    }, idx * 200);
                });
            })
            //.addIndicators()
            .addTo(controller2);

        /*sceneAnimate.on("enter", function (event) {
            console.log("Сцена вошла в видимость");
        });*/

        /* var controller3 = new ScrollMagic.Controller({globalSceneOptions: {}});*/

        new ScrollMagic.Scene({triggerElement: "#animate2"})
            .setClassToggle("#animate2", "active") // add class toggle
            .reverse(false)
            //.addIndicators()
            .addTo(controller2);
    }

    if (document.getElementById('sliderProduct')) {
        new Swiper('#sliderProduct', {
            lazyPreloadPrevNext: 2,
            slidesPerView: 4,
            spaceBetween: 26,
            navigation: {
                nextEl: '#sliderProductNext',
                prevEl: '#sliderProductPrev',
            },
            breakpoints: {
                300: {
                    slidesPerView: 'auto',
                    spaceBetween: 13

                },
                574: {
                    slidesPerView: 'auto',
                    spaceBetween: 13
                },
                769: {
                    slidesPerView: 3,
                    spaceBetween: 26
                },
                1200: {
                    slidesPerView: 4,
                    spaceBetween: 26
                }
            }
        });
    }
    if (document.getElementById('sliderNews')) {
        new Swiper('#sliderNews', {
            lazyPreloadPrevNext: 2,
            spaceBetween: 26,
            navigation: {
                nextEl: '#sliderNewsNext',
                prevEl: '#sliderNewsPrev',
            },
            breakpoints: {
                300: {
                    slidesPerView: 'auto',
                    spaceBetween: 13

                },
                574: {
                    slidesPerView: 'auto',
                    spaceBetween: 13
                },
                769: {
                    slidesPerView: 1,
                    spaceBetween: 26
                },
                1200: {
                    slidesPerView: 1,
                    spaceBetween: 26
                }
            }
        });
    }

    if (document.getElementById('productImg') && widthScreen < 992) {
        new Swiper('#productImg', {
            lazyPreloadPrevNext: 2,
            spaceBetween: 10,
            wrapperClass: 'product-page__images__list',
            pagination: {
                el: '#productImg .swiper-pagination',
                clickable: true,
            },

        });
    }

    Fancybox.bind("[data-fancybox]", {
        // Your custom options
    });

    const maskPhone = document.querySelectorAll('.js-mask-phone');
    maskPhone.forEach(el => {
        let im = new Inputmask("+7 999 999-99-99", {"clearIncomplete": true});
        im.mask(el);
    });


    const ranges = document.querySelectorAll('.js_range_filter');
    let inpMin = [];
    let inpMax = [];
    ranges.forEach((rangeEl, index) => {
        noUiSlider.create(rangeEl, {
            start: [0, parseInt(rangeEl.dataset.max)],
            step: parseInt(rangeEl.dataset.step),
            connect: true,
            tooltips: true,
            format: wNumb({
                decimals: 0,
                thousand: '',
                //suffix: ' ₽'
            }),
            range: {
                'min': parseInt(rangeEl.dataset.min),
                'max': parseInt(rangeEl.dataset.max)
            }
        });
        inpMin[index] = document.getElementById(rangeEl.dataset.idmin);
        inpMax[index] = document.getElementById(rangeEl.dataset.idmax);

        rangeEl.noUiSlider.on('update', function (values, handle) {
            if (handle == 0) {
                console.log('111');
                inpMin[index].value = values[handle];
            } else {
                inpMax[index].value = values[handle];
            }

            /*document.getElementById(rangeEl.dataset.idfilter).value = 1;*/
        });


    });

    if (document.getElementById('filterSlider')) {
        new Swiper('#filterSlider', {
            slidesPerView: 'auto',
        });
    }

});

function changeFilter(value = '', idInp = false) {

    if (document.getElementById(idInp)) {
        document.getElementById(idInp).value = value;
    }
}
